<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <style>

        .node circle {
          fill: #FFF;
          /*fill: #00B2EE;*/
          stroke: steelblue;
          stroke-width: .5px;
        }

        .node {
          font: 18px sans-serif;
        }

        .link {
          fill: none;
          stroke: #ccd;
          stroke-width: 1.5px;
        }
        </style>

        <title>D3 Test</title>
    </head>
    <body>
        <script src="https://d3js.org/d3.v3.js"></script>
        <!--<script type="text/javascript" src="d3.v3.js"></script>-->

        <script>
        var diameter = 1500;

        var tree = d3.layout.tree()
            .size([360, diameter / 1.5 - 380])
            .separation(function(a, b) { return (a.parent == b.parent ? 1 : 2) / a.depth; });

        var diagonal = d3.svg.diagonal.radial()
            .projection(function(d) { return [d.y, d.x / 180 * Math.PI]; });

        var svg = d3.select("body").append("svg")
            .attr("width", diameter)
            .attr("height", diameter - 50)
          .append("g")
            .attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");

        d3.json("receptors.json", function(error, root) {
          if (error) throw error;

          var nodes = tree.nodes(root),
              links = tree.links(nodes);

          var link = svg.selectAll(".link")
              .data(links)
            .enter().append("path")
              .attr("class", "link")
              .attr("d", diagonal);

          var node = svg.selectAll(".node")
              .data(nodes)
            .enter().append("g")
              .attr("class", "node")
              .attr("transform", function(d) { return "rotate(" + (d.x - 90) + ")translate(" + d.y + ")"; })

          node.append("circle")
              .attr("r", 6.5)
              .attr("id", "circleClicker")
              .style("fill", function(d) {return d.colorid;})
              .style("cursor", "pointer")
              .on({"mouseover": function(d) {
                document.getElementById("circleClicker").style("cursor", "pointer")
                },
                "mouseout": function(d) {
                document.getElementById("circleClicker").style("cursor", "default")
                }
            })
              .on("click", function(d) {
                window.location = "intermediary.html" + "?name=" + d.name;
               }); 

          node.append("text")
              .attr("dy", ".31em")
              .attr("text-anchor", function(d) { return d.x < 180 ? "start" : "end"; })
              .attr("transform", function(d) { return d.x < 180 ? "translate(8)" : "rotate(180)translate(-8)"; })
              .text(function(d) { return d.name; });
            
          node
            .append("a")
            .attr("xlink:href", function (d) { return "intermediary.html" + "?name=" + d.name; })
            .append("rect")
            .attr("class", "clickable")
            .attr("y", -6)
            .attr("x", function (d) { return d.children || d._children ? -60 : 10; })
            .attr("width", 50) //2*4.5)
            .attr("height", 12)
            .style("fill", "lightsteelblue")
            .style("fill-opacity", 0);

          function getRandomColor() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++ ) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
          }

          function coloring(d) {
            return getRandomColor()
            // return "#FF69B4"
            // return d._children ? "#FF69B4" : d.children ? "#c6dbef" : "#fd8d3c";
          }
        });

        d3.select(self.frameElement).style("height", diameter - 150 + "px");
        </script>
    </body>
</html>